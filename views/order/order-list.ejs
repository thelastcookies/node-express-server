<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css">
    <script type="text/javascript" src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/js/cookie.js"></script>

    <script>
        $(function() {
            if (getCookie ("username")) {
                $ ("#personal").css ("display", "block");
                $ ("#signin").css ("display", "none");

            }
            else if (!getCookie ("username")) {
                $ ("#personal").css ("display", "none");
                $ ("#signin").css ("display", "block");
            }
            else {
                return "";
            }
        });
    </script>
</head>
<body>
<header>
    <%- include('../header', {username: username}); %>

</header>
<section>
    <div class="table-responsive container">
        <table class="table table-striped table-hover">
            <caption>我发起的交易请求</caption>
            <thead>
            <tr>
                <th>接收方</th>
                <th>发起时间</th>
                <th>出售/求购</th>
                <th>物品编号</th>
                <th>物品名称</th>
                <th>交易状态</th>
                <th>操作</th>
                <th>查看</th>
            </tr>
            </thead>
            <tbody style="color: gray;">
            <tr ng-class="{pending: tradeOrder.status=='agree'}" ng-repeat="tradeOrder in tradeOrderList | filter:{creator:{_id:authentication.user._id}}">
                <td ng-bind="tradeOrder.receiver.username"></td>
                <td ng-bind="tradeOrder.created | date:'y/MM/dd'"></td>
                <td ng-bind="tradeOrder.offer_or_get=='offer' ? '出售' : '求购'"></td>
                <td ng-bind="tradeOrder.product._id"></td>
                <td ng-bind="tradeOrder.product.name"></td>
                <td>
                    <span ng-if="tradeOrder.status=='pending'">等待对方回复中</span>
                    <span ng-if="tradeOrder.status=='agree'">对方已同意交易</span>
                    <span ng-if="tradeOrder.status=='cancel'">交易已取消</span>
                    <span ng-if="tradeOrder.status=='finished'">交易已结束</span>
                </td>
                <td>
                    <span ng-if="tradeOrder.status=='pending'"><a ng-click="agreeTrade(tradeOrder,false)">取消交易</a></span>
                    <span ng-if="tradeOrder.status=='agree' || tradeOrder.status=='cancel'"><a ng-click="finishTrade(tradeOrder)">确认</a></span>
                </td>
                <td><a href="#!/tradeOrder/{{authentication.user.username}}/{{tradeOrder._id}}">查看</a></td>
            </tr>
            </tbody>
        </table>
        <table class="table table-striped table-hover">
            <caption>我收到的交易请求</caption>
            <thead>
            <tr>
                <th>请求方</th>
                <th>发起时间</th>
                <th>出售/求购</th>
                <th>物品编号</th>
                <th>物品名称</th>
                <th>交易状态</th>
                <th>操作</th>
                <th>查看</th>
            </tr>
            </thead>
            <tbody style="color: gray;">
            <tr ng-class="{pending: tradeOrder.status=='pending'}" ng-repeat="tradeOrder in tradeOrderList | filter:{receiver:{_id:authentication.user._id}}">
                <td ng-bind="tradeOrder.creator.username"></td>
                <td ng-bind="tradeOrder.created | date:'y/MM/dd'"></td>
                <td ng-bind="tradeOrder.offer_or_get=='offer' ? '出售' : '求购'"></td>
                <td ng-bind="tradeOrder.product._id"></td>
                <td ng-bind="tradeOrder.product.name"></td>
                <td>
                    <span ng-if="tradeOrder.status=='pending'">待处理</span>
                    <span ng-if="tradeOrder.status=='agree'">已同意本次交易</span>
                    <span ng-if="tradeOrder.status=='cancel'">本次交易已取消</span>
                    <span ng-if="tradeOrder.status=='finished'">本次交易已结束</span>
                </td>
                <td>
                    <span ng-if="tradeOrder.status=='pending'">
                        <a ng-click="agreeTrade(tradeOrder,true)">同意交易</a> / <a ng-click="agreeTrade(tradeOrder,false)">取消交易</a>
                    </span>
                </td>
                <td><a href="#!/tradeOrder/{{authentication.user.username}}/{{tradeOrder._id}}">查看</a></td>
            </tr>
            </tbody>
        </table>
    </div>

</section>
</body>
</html>
