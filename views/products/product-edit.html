<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css">
    <script type="text/javascript" src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="/js/cookie.js"></script>

    <script>
        let imgSrc = null;
        $(function() {
            if (getCookie ("username")) {
                $ ("#personal").css ("display", "block");
                $ ("#signin").css ("display", "none");

            }
            else if (!getCookie ("username")) {
                $ ("#personal").css ("display", "none");
                $ ("#signin").css ("display", "block");
            }
            else {
                return "";
            }

            $("#submit").on("click", function (e) {
                e.preventDefault();
                let name = $("#name").val();
                let category = $("#category").val();
                let price = $("#price").val();
                let details = $("#details").val();
                let username = getCookie('username');
                $.ajax({
                    url: '/productModify',
                    data: {
                        "name": name,
                        "category": category,
                        "price": price,
                        "details": details,
                        "image": imgSrc,
                        "username": username
                    },
                    type: 'post',
                    dataType: 'json',
                    headers: {
                        "Access-Control-Allow-Origin":"http://example.edu",
                        "Access-Control-Allow-Headers":"X-Requested-With"
                    },
                    success: function (status) {
                        console.log(status);
                        if (status) {
                            alert ("商品添加错误！");
                            return ;
                        }
                        alert("商品添加成功！");
                        window.location.href = "/products";
                    },
                    error: function (XMLHttpRequset, textStatus, errorThrown) {
                        console.log (XMLHttpRequset);
                        console.log (textStatus);
                        console.log (errorThrown);
                    }
                });

            });
        });

        function imgUpload (e) {
            let img = e.target.files[0];
            if (img.size > 1024 * 1024 * 2) {
                alert('图片大小不能超过 2MB!');
                return false;
            }

            var reader = new FileReader();
            reader.onload = function() {
                imgSrc = this.result;  //图片base64字符串
            };
            reader.readAsDataURL(img);    //Base64
        }
    </script>
</head>
<body>
<header>
    <nav class="navbar navbar-default">
        <div class="container">
            <div class="navbar-header">
                <button target="#navbar-collapse-01" toggle="collapse" class="navbar-toggle" type="button">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="/" class="navbar-brand" style="padding: 8px;"><img style="height: 100%;" src="/img/logo-black.png" alt=""></a>
            </div>
            <div id="navbar-collapse-01" class="navbar-collapse collapse"  style="height: 0.8px;">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/products/edit">发布</a></li>
                    <li class="dropdown" id="personal">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">个人中心 <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="/products">我的出售物品</a></li>
                            <li><a href="/order">我的交易</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="/user">当前账号：</a></li>
                            <li><a href="/user/modify">修改我的账号</a></li>
                            <li role="separator" class="divider"></li>
                            <li id = "signOut"><a href="#">登出</a></li>
                        </ul>
                    </li>
                    <li id = "signin"><a href="signin">登录/注册</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<section>
<div class="container">
    <div class="panel panel-primary">
        <div class="panel-heading">发布出售物品</div>
        <div class="panel-body">
            <form class="form-horizontal" novalidate enctype="multipart/form-data" name="create_product" id="create_product">
                <!--name-->
                <div class="form-group">
                    <label for="name" class="control-label col-lg-3">物品名称</label>
                    <div class="col-lg-9">
                        <input required type="text" id="name" name="name" class="form-control">
                    </div>
                </div>
                <!--category-->
                <div class="form-group">
                    <label for="category" class="col-lg-3 control-label">分类</label>
                    <div class="col-lg-9">
                        <select required name="category" id="category" class="form-control">
                            <option value="">请选择分类</option>
                            <option value="书籍">书籍</option>
                            <option value="衣物">衣物</option>
                            <option value="电子产品">电子产品</option>
                            <option value="日常用品">日常用品</option>
                            <option value="其它">其它</option>
                        </select>
                    </div>
                </div>
                <!--image-->
                <div class="form-group">
                    <label for="image" class="control-label col-lg-3">图片</label>
                    <div class="col-lg-9">
                        <input type="file" accept="image/*" name="image" id="upImage" onchange="imgUpload(event)" />
                    </div>
                </div>
                <!--price-->
                <div class="form-group">
                    <label for="price" class="control-label col-lg-3">价格</label>
                    <div class="col-lg-9">
                        <div class="input-group">
                            <span class="input-group-addon">￥</span>
                            <input required class="form-control" type="text" id="price" name="price">
                        </div>
                    </div>
                </div>
                <!--details-->
                <div class="form-group">
                    <label for="details" class="control-label col-lg-3">详情描述</label>
                    <div class="col-lg-9">
                        <textarea required class="form-control" name="details" id="details" cols="30" rows="5"></textarea>
                    </div>
                </div>
                <!--submit-->
                <div class="form-group">
                    <div class="col-lg-offset-3 col-lg-9">
                        <button class="btn btn-primary" id="submit">发布</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
</section>
</body>
</html>
